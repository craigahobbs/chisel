<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>JSON APIs &#8212; chisel 1.4.8 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=f6a572b4" />
    <script src="_static/documentation_options.js?v=b2e12b12"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Built-in Requests" href="request.html" />
    <link rel="prev" title="WSGI Applications" href="app.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  
    <link rel="canonical" href="https://craigahobbs.github.io/chisel/action.html" />
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">chisel</a></h1>



<p class="blurb">Lightweight Python back-end application framework</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=craigahobbs&repo=chisel&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="app.html">WSGI Applications</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">JSON APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#action-decorator">action decorator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#action">Action</a></li>
<li class="toctree-l2"><a class="reference internal" href="#actionerror">ActionError</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="request.html">Built-in Requests</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="app.html" title="previous chapter">WSGI Applications</a></li>
      <li>Next: <a href="request.html" title="next chapter">Built-in Requests</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="json-apis">
<h1>JSON APIs<a class="headerlink" href="#json-apis" title="Link to this heading">¶</a></h1>
<section id="action-decorator">
<h2>action decorator<a class="headerlink" href="#action-decorator" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="chisel.action">
<span class="sig-prename descclassname"><span class="pre">&#64;</span></span><span class="sig-prename descclassname"><span class="pre">chisel.</span></span><span class="sig-name descname"><span class="pre">action</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action_callback</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#chisel.action" title="Link to this definition">¶</a></dt>
<dd><p>Decorator for creating an <a class="reference internal" href="#chisel.Action" title="chisel.Action"><code class="xref py py-class docutils literal notranslate"><span class="pre">Action</span></code></a> object that wraps an action callback function. For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@chisel</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="s1"># Sum a list of numbers</span>
<span class="gp">... </span><span class="s1">action sum_numbers</span>
<span class="gp">... </span><span class="s1">    urls</span>
<span class="gp">... </span><span class="s1">        GET</span>
<span class="gp">... </span><span class="s1">    query</span>
<span class="gp">... </span><span class="s1">        # The list of numbers to sum</span>
<span class="gp">... </span><span class="s1">        int[len &gt; 0] numbers</span>
<span class="gp">... </span><span class="s1">    output</span>
<span class="gp">... </span><span class="s1">        # The sum of the numbers</span>
<span class="gp">... </span><span class="s1">        int sum</span>
<span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">sum_numbers</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;sum&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="s1">&#39;numbers&#39;</span><span class="p">])}</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span> <span class="o">=</span> <span class="n">chisel</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">sum_numbers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/sum_numbers&#39;</span><span class="p">,</span> <span class="n">query_string</span><span class="o">=</span><span class="s1">&#39;numbers.0=1&amp;numbers.1=2&amp;numbers.2=3&#39;</span><span class="p">)</span>
<span class="go">(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;application/json&#39;)], b&#39;{&quot;sum&quot;:6}&#39;)</span>
</pre></div>
</div>
<p>Chisel actions schema-validate their input before calling the callback function. For example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">status</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">application</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/sum_numbers&#39;</span><span class="p">,</span> <span class="n">query_string</span><span class="o">=</span><span class="s1">&#39;numbers=1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">status</span>
<span class="go">&#39;400 Bad Request&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)))</span>
<span class="go">{&#39;error&#39;: &#39;InvalidInput&#39;,</span>
<span class="go"> &#39;member&#39;: &#39;numbers&#39;,</span>
<span class="go"> &#39;message&#39;: &quot;Invalid value &#39;1&#39; (type &#39;str&#39;) for member &#39;numbers&#39;, expected &quot;</span>
<span class="go">            &quot;type &#39;array&#39; (query string)&quot;}</span>
</pre></div>
</div>
<p>When <a class="reference internal" href="app.html#chisel.Application.validate_output" title="chisel.Application.validate_output"><code class="xref py py-attr docutils literal notranslate"><span class="pre">validate_output</span></code></a> the response dictionary is also validated to the output schema.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>action_callback</strong> (<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable" title="(in Python v3.13)"><em>Callable</em></a>) – The action callback function</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="action">
<h2>Action<a class="headerlink" href="#action" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="chisel.Action">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">chisel.</span></span><span class="sig-name descname"><span class="pre">Action</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">action_callback</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">urls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(('POST',</span> <span class="pre">None),)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">types</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wsgi_response</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jsonp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#chisel.Action" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="app.html#chisel.Request" title="chisel.request.Request"><code class="xref py py-class docutils literal notranslate"><span class="pre">Request</span></code></a></p>
<p>A schema-validated, JSON API request. An Action wraps a callback function that it calls when a request occurs. Here’s
an example of an action callback function:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">my_action</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">return</span> <span class="p">{}</span>
</pre></div>
</div>
<p>The first arugument, “ctx”, is the <a class="reference internal" href="app.html#chisel.Context" title="chisel.Context"><code class="xref py py-class docutils literal notranslate"><span class="pre">Context</span></code></a> object. The second argument is the request object which
contiains the schema-validated, combined path parameters, query string parameters, and JSON request content
parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>action_callback</strong> (<a class="reference external" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Callable" title="(in Python v3.13)"><em>Callable</em></a>) – The action callback function</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The action request name</p></li>
<li><p><strong>urls</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><em>list</em></a><em>(</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><em>tuple</em></a><em>)</em>) – The list of URL method/path tuples. The first value is the HTTP request method (e.g. ‘GET’)
or None to match any. The second value is the URL path or None to use the default path.</p></li>
<li><p><strong>types</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><em>dict</em></a>) – Optional dictionary of user type models</p></li>
<li><p><strong>spec</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Optional action <a class="reference external" href="https://craigahobbs.github.io/schema-markdown-js/language/">Schema Markdown</a> specification.
If a specification isn’t provided it can be provided through the “types” argument.</p></li>
<li><p><strong>wsgi_response</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><em>bool</em></a>) – If True, the callback function’s response is a WSGI application function
response. Default is False.</p></li>
<li><p><strong>jsonp</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Optional JSONP key</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.Action.action_callback">
<span class="sig-name descname"><span class="pre">action_callback</span></span><a class="headerlink" href="#chisel.Action.action_callback" title="Link to this definition">¶</a></dt>
<dd><p>The action callback function</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.Action.jsonp">
<span class="sig-name descname"><span class="pre">jsonp</span></span><a class="headerlink" href="#chisel.Action.jsonp" title="Link to this definition">¶</a></dt>
<dd><p>JSONP key or None</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="chisel.Action.model">
<em class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">model</span></span><a class="headerlink" href="#chisel.Action.model" title="Link to this definition">¶</a></dt>
<dd><p>Get the action model</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.Action.types">
<span class="sig-name descname"><span class="pre">types</span></span><a class="headerlink" href="#chisel.Action.types" title="Link to this definition">¶</a></dt>
<dd><p>The user type model dictionary that contains the action model and all referenced user types</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.Action.wsgi_response">
<span class="sig-name descname"><span class="pre">wsgi_response</span></span><a class="headerlink" href="#chisel.Action.wsgi_response" title="Link to this definition">¶</a></dt>
<dd><p>If True, the callback function’s response is a WSGI application function response.</p>
</dd></dl>

</dd></dl>

</section>
<section id="actionerror">
<h2>ActionError<a class="headerlink" href="#actionerror" title="Link to this heading">¶</a></h2>
<dl class="py exception">
<dt class="sig sig-object py" id="chisel.ActionError">
<em class="property"><span class="k"><span class="pre">exception</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">chisel.</span></span><span class="sig-name descname"><span class="pre">ActionError</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">error</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">status</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#chisel.ActionError" title="Link to this definition">¶</a></dt>
<dd><p>An action error exception. Raise this exception within an action callback function to respond with an error.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nd">@chisel</span><span class="o">.</span><span class="n">action</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;</span>
<span class="gp">... </span><span class="s1">action my_action</span>
<span class="gp">... </span><span class="s1">    urls</span>
<span class="gp">... </span><span class="s1">        GET</span>
<span class="gp">... </span><span class="s1">    errors</span>
<span class="gp">... </span><span class="s1">        AlwaysError</span>
<span class="gp">... </span><span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">my_action</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
<span class="gp">... </span>   <span class="k">raise</span> <span class="n">chisel</span><span class="o">.</span><span class="n">ActionError</span><span class="p">(</span><span class="s1">&#39;AlwaysError&#39;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span> <span class="o">=</span> <span class="n">chisel</span><span class="o">.</span><span class="n">Application</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span><span class="o">.</span><span class="n">add_request</span><span class="p">(</span><span class="n">my_action</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">application</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;/my_action&#39;</span><span class="p">)</span>
<span class="go">(&#39;400 Bad Request&#39;, [(&#39;Content-Type&#39;, &#39;application/json&#39;)], b&#39;{&quot;error&quot;:&quot;AlwaysError&quot;}&#39;)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>error</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The error code</p></li>
<li><p><strong>message</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – Optional error message</p></li>
<li><p><strong>status</strong> (<a class="reference external" href="https://docs.python.org/3/library/http.html#http.HTTPStatus" title="(in Python v3.13)"><em>HTTPStatus</em></a><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><em>str</em></a>) – The HTTP response status</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.ActionError.error">
<span class="sig-name descname"><span class="pre">error</span></span><a class="headerlink" href="#chisel.ActionError.error" title="Link to this definition">¶</a></dt>
<dd><p>The error code</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.ActionError.message">
<span class="sig-name descname"><span class="pre">message</span></span><a class="headerlink" href="#chisel.ActionError.message" title="Link to this definition">¶</a></dt>
<dd><p>The error message or None</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="chisel.ActionError.status">
<span class="sig-name descname"><span class="pre">status</span></span><a class="headerlink" href="#chisel.ActionError.status" title="Link to this definition">¶</a></dt>
<dd><p>The HTTP response status</p>
</dd></dl>

</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2012, Craig A. Hobbs.
      
    </div>

    

    
  </body>
</html>